window.Funnelback||(window.Funnelback={}),window.Funnelback.SessionHistory=function(){"use strict";var e=function(e){return this.init(e)};e.defaults={apiBase:"/",collection:null,historySelector:"#search-history",clickEmptySelector:".session-history-click-empty",clickResultsSelector:".session-history-click-results",searchEmptySelector:".session-history-search-empty",searchResultsSelector:".session-history-search-results",pageSelector:["#search-results-content","#search-cart"],clearClickSelector:".session-history-clear-click",clearSearchSelector:".session-history-clear-search",hideSelector:".session-history-hide",showSelector:".session-history-show",currentSearchHistorySelectors:[".session-history-breadcrumb"],currentClickHistorySelectors:[".session-history-link"],toggleSelector:".session-history-toggle"},e.prototype.init=function(t){return t.collection?((e.options=s.extend(e.defaults,t||{})).pageSelector||(e.options.pageSelector=[]),o.init(e.options),this):(console.error('Missing "collection" parameter'),null)},e.prototype.destroy=function(){return e.options={},null},e.prototype.clearClicks=function(){return o.clear(this.getOption(),"click"),this},e.prototype.clearSearches=function(){return o.clear(this.getOption(),"search"),this},e.prototype.getOption=function(t,o){return 0===arguments.length?e.options:"string"==typeof t?e.options[t]:void 0},e.prototype.show=function(){return o.history&&(o.history.style.display="block"),o.toggle(o.page,"page","none"),o.isHidden=!1,this},e.prototype.hide=function(){return o.history&&(o.history.style.display="none"),o.toggle(o.page,"page","block"),o.isHidden=!0,this},e.prototype.toggle=function(){return o.isHidden?e.prototype.show():e.prototype.hide()};const t={clickUrl:"s/click-history.json",searchUrl:"s/search-history.json",delete:function(e,o){return t.request("delete",e,o)},request:function(e,o,s){return new Promise((function(r,n){const l=new XMLHttpRequest,c=t.getUrl(o,s);l.withCredentials=!0,l.onload=function(){if(200!==this.status)n({url:c,error:this});else try{const e=JSON.parse(this.responseText);r({url:c,data:e})}catch(e){n({url:c,error:e})}},l.onerror=function(){n({url:c,error:l})},l.open(e,c,!0),l.setRequestHeader("Accept","application/json"),l.setRequestHeader("Content-Type","text/plain"),l.send()}))},getParamsString:function(e){const t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(encodeURIComponent(o)+"="+encodeURIComponent(e[o]));return t.join("&")},getUrl:function(e,o){return e.apiBase+t[o+"Url"]+"?"+t.getParamsString({collection:e.collection})}},o={history:null,page:[],clickClear:null,clickEmpty:null,clickResults:null,searchClear:null,searchEmpty:null,searchResults:null,clickHistoryLinks:[],searchHistoryLinks:[],toggleStates:{page:null,clickEmpty:null,searchEmpty:null,clickHistoryLinks:null,searchHistoryLinks:null},isHidden:!0,init:function(t){var s,r;for(o.setElement(t.historySelector,"history","warn"),o.history&&(o.history.style.display="none"),o.setElement(t.clickEmptySelector,"clickEmpty"),o.setElement(t.clickResultsSelector,"clickResults"),o.setElement(t.searchEmptySelector,"searchEmpty"),o.setElement(t.searchResultsSelector,"searchResults"),o.setListeners(t.showSelector,e.prototype.show),o.setListeners(t.hideSelector,e.prototype.hide),o.setListeners(t.toggleSelector,e.prototype.toggle),o.setListeners(t.clearClickSelector,e.prototype.clearClicks,"clickClear"),o.setListeners(t.clearSearchSelector,e.prototype.clearSearches,"searchClear"),o.clickResults?o.results("click"):o.noResults("click"),o.searchResults?o.results("search"):o.noResults("search"),s=0,r=t.pageSelector.length;s<r;s++){const e=document.querySelector(t.pageSelector[s]);e?o.page.push(e):console.warn("No element was found for "+t.pageSelector[s]+" selector")}for(s=0,r=t.currentSearchHistorySelectors.length;s<r;s++){const e=document.querySelectorAll(t.currentSearchHistorySelectors[s]);Array.prototype.push.apply(o.searchHistoryLinks,e)}for(s=0,r=t.currentClickHistorySelectors.length;s<r;s++){const e=document.querySelectorAll(t.currentClickHistorySelectors[s]);Array.prototype.push.apply(o.clickHistoryLinks,e)}},clear:function(e,s){confirm("Your "+s+" history will be cleared")&&t.delete(e,s).then((function(e){o.noResults(s),o.toggle(o[s+"HistoryLinks"],s+"HistoryLinks","none")})).catch((function(e){console.error("Something went wrong and "+s+" history was not cleared. Please try again later...",e)}))},setElement:function(e,t,s){o[t]=document.querySelector(e),o[t]||console[s||"log"]("No element was found for "+e+" selector")},setListeners:function(t,s,r){const n=document.querySelectorAll(t);for(var l=0,c=n.length;l<c;l++)n[l].addEventListener("click",s.bind(e.prototype));r&&(o[r]=n)},noResults:function(e){o.toggle(o[e+"Clear"],"none"),o[e+"Empty"]&&o.toggle([o[e+"Empty"]],e+"Empty","block"),o[e+"Results"]&&o.toggle([o[e+"Results"]],e+"Results","none")},results:function(e){o[e+"Empty"]&&o.toggle([o[e+"Empty"]],e+"Empty","none"),o[e+"Results"]&&o.toggle([o[e+"Results"]],e+"Results","block")},toggle:function(e,t,s){o.toggleStates[t]&&"none"!==s||(o.toggleStates[t]=e);const r=[];for(var n=0,l=e.length;n<l;n++){const l=e[n];-1!==Array.prototype.indexOf.call(o.toggleStates[t],l)&&l.style.display!==s&&(l.style.display=s,r.push(l))}o.toggleStates[t]=r}},s={extend:function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]="object"==typeof t[o]?s.extend(e[o]||{},t[o]):t[o]);return e}};return e}();